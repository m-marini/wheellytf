import logging

import pygame
from tensorforce import Environment
from tensorforce.agents import Agent

from wheelly.envs import RobotEnv


def main():
    logging.basicConfig(level=logging.DEBUG, format='%(asctime)s %(levelname)s %(name)s: %(message)s')
    logging.getLogger("wheelly.envs.robot").setLevel(logging.DEBUG)

    environment:RobotEnv = Environment.create(
        environment=RobotEnv,
        robotHost="192.168.1.11",
        robotPort=22
    )

    agent:Agent = Agent.create(
        agent='a2c',
    #    agent='ac',
    #    agent='random',
        environment=environment,
        batch_size=10
    )

    states = environment.reset()
    environment.render()

    running = True
    while running:
        actions = agent.act(states=states)
        states, terminal, reward = environment.execute(actions=actions)
        agent.observe(terminal=terminal, reward=reward)
        environment.render()
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
                break
    environment.close()
    pygame.quit()

if __name__ == '__main__':
    main()
